<html>
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  </head>
  <body>
    <!-- https://stackoverflow.com/questions/42825972/update-html-when-change-is-noticed-in-mysql-database -->
    <!-- If we change this it will update to db and change html text/ We need a update function still. -->
    <p id="name">Felix</p>
    <div id="txtHint"><b>Person info will be listed here...</b></div>
  </body>
  <script>
    const rfidsArray = [];
    // getTable and updateName work with xmlhttprequest and getRfid with ajax and a promise. First functions need refactor but work atm.

    function getTable() {
      var xmlhttp = new XMLHttpRequest();
      xmlhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
          document.getElementById("txtHint").innerHTML = this.responseText;
        }
      };
      xmlhttp.open("GET", "getTable.php", true);
      xmlhttp.send();
    }

    function updateName() {
      var xmlhttp = new XMLHttpRequest();
      xmlhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
          // Add input method here for the name
          document.getElementById("test").innerHTML =
            document.getElementById("name").textContent;
        }
      };
      xmlhttp.open(
        "POST",
        "updateName.php?laeufer_name=" +
          document.getElementById("name").textContent +
          "&rfid=1",
        true
      );
      xmlhttp.send();
    }

    function getRfids() {
      return new Promise(function (resolve, reject) {
        $.ajax({
          url: "getRfids.php",
          type: "GET",
          dataType: "json",
          beforeSend: function () {},
          success: function (data) {
            resolve(data); // Resolve promise and when success
            //console.log(data);
          },
          error: function (err) {
            reject(err); // Reject the promise and go to catch()
          },
        });
      });
    }

    getTable();
    updateName();
    //getRfidArray();
    getRfids()
      .then(function (data) {
        while (data.length > 0) {
          rfidsArray.push(data.pop());
        }
      })
      .then(function () {
        console.log("rfidsArray: " + rfidsArray);
      });
  </script>
</html>
